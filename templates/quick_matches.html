{% extends "base.html" %}

{% block content %}
<div class="card" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none;">
    <h1>INSTANT PLAY MODE</h1>
    <p>OCR Screenshot Verification - Submit victory proof, get verified automatically (70% success rate)</p>
</div>

<div class="games-grid">
    {% for game in games %}
    <div class="game-card">
        <img src="{{ game.image }}" alt="{{ game.name }}" style="width: 100%; height: 120px; object-fit: contain; border-radius: 8px; margin-bottom: 1rem; background: rgba(255,255,255,0.1);">
        <h3>{{ game.name }}</h3>
        <p>Min: KSh {{ game.min_bet }} | Max: KSh {{ game.max_bet }}</p>
        <p style="color: #28a745; font-size: 0.9rem; font-weight: bold;">OCR SCREENSHOT VERIFICATION</p>
        <p style="color: #666; font-size: 0.9rem;">Balance: KSh {{ "%.0f"|format(session.balance if session.balance else 0) }}</p>
        
        <div class="quick-match-form">
            <input type="number" id="bet-{{ game.id }}" placeholder="Bet Amount" min="{{ game.min_bet }}" max="{{ game.max_bet }}" required style="width: 100%; padding: 0.5rem; margin-bottom: 0.5rem; background: #333; color: white; border: 1px solid #555; border-radius: 4px;">
            <select id="mode-{{ game.id }}" required style="width: 100%; padding: 0.5rem; margin-bottom: 0.5rem; background: #333; color: white; border: 1px solid #555; border-radius: 4px;">
                <option value="">Select Mode</option>
                {% for mode in game.modes %}
                <option value="{{ mode }}">{{ mode }}</option>
                {% endfor %}
            </select>
            <button onclick="joinQuickMatch('{{ game.id }}')" class="btn btn-primary" style="width: 100%;">Join Quick Match</button>
        </div>
    </div>
    {% endfor %}
</div>

<script>
function joinQuickMatch(gameId) {
    const betAmount = document.getElementById('bet-' + gameId).value;
    const gameMode = document.getElementById('mode-' + gameId).value;
    
    if (!betAmount || !gameMode) {
        alert('Please fill in all fields');
        return;
    }
    
    const button = event.target;
    button.disabled = true;
    button.textContent = 'Joining...';
    
    fetch('/create_match', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            game: gameId,
            bet_amount: parseFloat(betAmount),
            game_mode: gameMode,
            verification_type: 'ocr'
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            if (data.redirect) {
                window.location.href = data.redirect;
            } else if (data.match_id) {
                window.location.href = '/match_lobby/' + data.match_id;
            }
        } else {
            alert('Error: ' + data.error);
            button.disabled = false;
            button.textContent = 'Join Quick Match';
        }
    })
    .catch(error => {
        alert('Connection error');
        button.disabled = false;
        button.textContent = 'Join Quick Match';
    });
}
</script>
{% endblock %}