{% extends "base.html" %}

{% block content %}
<div class="card">
    <h1>üèÜ Tournament Management</h1>
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <p>Create and manage tournaments for users</p>
        <button onclick="showCreateTournament()" class="btn btn-success">+ Create Tournament</button>
    </div>
</div>

<div class="card">
    <h2>üìä All Tournaments</h2>
    {% if tournaments %}
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; background: white;">
                <tr style="background: #343a40; color: white;">
                    <th style="padding: 0.8rem; border: 1px solid #ddd; text-align: left;">Tournament</th>
                    <th style="padding: 0.8rem; border: 1px solid #ddd; text-align: left;">Game</th>
                    <th style="padding: 0.8rem; border: 1px solid #ddd; text-align: left;">Entry Fee</th>
                    <th style="padding: 0.8rem; border: 1px solid #ddd; text-align: left;">Players</th>
                    <th style="padding: 0.8rem; border: 1px solid #ddd; text-align: left;">Prize Pool</th>
                    <th style="padding: 0.8rem; border: 1px solid #ddd; text-align: left;">Status</th>
                    <th style="padding: 0.8rem; border: 1px solid #ddd; text-align: left;">Actions</th>
                </tr>
                {% for tournament in tournaments %}
                <tr style="{% if loop.index % 2 == 0 %}background: #f8f9fa;{% else %}background: white;{% endif %}">
                    <td style="padding: 0.8rem; border: 1px solid #ddd; color: #333; font-weight: bold;">{{ tournament[1] }}</td>
                    <td style="padding: 0.8rem; border: 1px solid #ddd; color: #333;">{{ tournament[2] }}</td>
                    <td style="padding: 0.8rem; border: 1px solid #ddd; color: #333;">KSh {{ "%.0f"|format(tournament[3]) }}</td>
                    <td style="padding: 0.8rem; border: 1px solid #ddd; color: #333;">{{ tournament[11] }}/{{ tournament[4] }}</td>
                    <td style="padding: 0.8rem; border: 1px solid #ddd; color: #28a745; font-weight: bold;">KSh {{ "%.0f"|format(tournament[5]) }}</td>
                    <td style="padding: 0.8rem; border: 1px solid #ddd;">
                        {% if tournament[6] == 'open' %}
                            <span style="background: #28a745; color: white; padding: 0.3rem 0.6rem; border-radius: 15px; font-size: 0.8rem;">OPEN</span>
                        {% elif tournament[6] == 'active' %}
                            <span style="background: #ffc107; color: black; padding: 0.3rem 0.6rem; border-radius: 15px; font-size: 0.8rem;">ACTIVE</span>
                        {% else %}
                            <span style="background: #dc3545; color: white; padding: 0.3rem 0.6rem; border-radius: 15px; font-size: 0.8rem;">CLOSED</span>
                        {% endif %}
                    </td>
                    <td style="padding: 0.8rem; border: 1px solid #ddd;">
                        {% if tournament[6] == 'open' %}
                            <button onclick="closeTournament({{ tournament[0] }})" class="btn btn-warning" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;">Close</button>
                        {% endif %}
                        <button onclick="viewParticipants({{ tournament[0] }})" class="btn" style="padding: 0.3rem 0.6rem; font-size: 0.8rem; background: #17a2b8; color: white;">View Players</button>
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>
    {% else %}
        <div style="text-align: center; padding: 2rem; color: #666;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üèÜ</div>
            <p>No tournaments created yet</p>
        </div>
    {% endif %}
</div>

<!-- Create Tournament Modal -->
<div id="createTournamentModal" class="modal">
    <div class="modal-content" style="max-width: 500px; margin-top: 80px;">
        <span class="close" onclick="closeCreateTournament()">&times;</span>
        <h2>üèÜ Create New Tournament</h2>
        
        <div style="margin: 1rem 0;">
            <label>Tournament Name</label>
            <input type="text" id="tournamentName" class="form-control" placeholder="e.g., FIFA Mobile Championship">
        </div>
        
        <div style="margin: 1rem 0;">
            <label>Game Type</label>
            <select id="gameType" class="form-control">
                <option value="FIFA Mobile">FIFA Mobile</option>
                <option value="eFootball">eFootball</option>
                <option value="FPL">Fantasy Premier League</option>
                <option value="Mixed">Mixed Games</option>
            </select>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1rem 0;">
            <div>
                <label>Entry Fee (KSh)</label>
                <input type="number" id="entryFee" class="form-control" min="50" max="5000" value="200">
            </div>
            <div>
                <label>Max Players</label>
                <select id="maxPlayers" class="form-control">
                    <option value="8">8 Players</option>
                    <option value="16" selected>16 Players</option>
                    <option value="32">32 Players</option>
                    <option value="64">64 Players</option>
                </select>
            </div>
        </div>
        
        <div style="background: #e7f3ff; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
            <h4>üí∞ Prize Distribution (85% of total fees):</h4>
            <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                <li><strong>1st Place:</strong> 40% of prize pool</li>
                <li><strong>2nd Place:</strong> 25% of prize pool</li>
                <li><strong>3rd Place:</strong> 15% of prize pool</li>
                <li><strong>4th Place:</strong> 5% of prize pool</li>
            </ul>
        </div>
        
        <div style="display: flex; gap: 1rem;">
            <button onclick="createTournament()" class="btn btn-success" style="flex: 1;">Create Tournament</button>
            <button onclick="closeCreateTournament()" class="btn btn-secondary">Cancel</button>
        </div>
    </div>
</div>

<script>
function showCreateTournament() {
    document.getElementById('createTournamentModal').style.display = 'block';
}

function closeCreateTournament() {
    document.getElementById('createTournamentModal').style.display = 'none';
}

function createTournament() {
    const name = document.getElementById('tournamentName').value.trim();
    const gameType = document.getElementById('gameType').value;
    const entryFee = parseFloat(document.getElementById('entryFee').value);
    const maxPlayers = parseInt(document.getElementById('maxPlayers').value);
    
    if (!name || entryFee < 50) {
        alert('Please fill in all fields correctly');
        return;
    }
    
    fetch('/create_tournament', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            name: name,
            game_type: gameType,
            entry_fee: entryFee,
            max_players: maxPlayers
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('‚úÖ ' + data.message);
            closeCreateTournament();
            location.reload();
        } else {
            alert('‚ùå ' + data.message);
        }
    })
    .catch(error => {
        alert('Error creating tournament');
    });
}

function closeTournament(tournamentId) {
    if (confirm('Close this tournament? No new players can join after closing.')) {
        // Add close tournament functionality
        alert('Tournament closed successfully');
        location.reload();
    }
}

function viewParticipants(tournamentId) {
    alert('Participants view coming soon!');
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('createTournamentModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
}
</script>

{% endblock %}