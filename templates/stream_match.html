<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stream Your Match - SkillState</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            padding: 2rem;
        }
        .container { max-width: 800px; margin: 0 auto; }
        .card { 
            background: rgba(255,255,255,0.1); 
            padding: 2rem; 
            border-radius: 15px;
            backdrop-filter: blur(10px);
            margin-bottom: 2rem;
        }
        .stream-controls { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 2rem; 
            margin: 2rem 0;
        }
        .control-panel { 
            background: rgba(0,0,0,0.3); 
            padding: 1.5rem; 
            border-radius: 10px;
        }
        .btn { 
            padding: 1rem 2rem; 
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            color: black;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin: 0.5rem;
            transition: transform 0.3s;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn-danger { background: linear-gradient(45deg, #ff4757, #ff3742); color: white; }
        .stream-info { 
            background: rgba(255,193,7,0.2); 
            padding: 1rem; 
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }
        .viewers { 
            display: flex; 
            align-items: center; 
            gap: 0.5rem;
            font-size: 1.2rem;
        }
        .live-indicator { 
            background: #ff4757; 
            padding: 0.3rem 0.8rem; 
            border-radius: 15px;
            font-size: 0.8rem;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>ðŸ”´ Live Stream Match #{{ match_id }}</h1>
            <div class="live-indicator">LIVE</div>
            <div class="viewers">
                <span>ðŸ‘¥</span>
                <span id="viewer-count">0</span>
                <span>viewers watching</span>
            </div>
        </div>

        <div class="stream-controls">
            <div class="control-panel">
                <h3>Stream Controls</h3>
                <button class="btn" onclick="startStream()" id="start-btn">Start Streaming</button>
                <button class="btn btn-danger" onclick="stopStream()" id="stop-btn" disabled>Stop Stream</button>
                <button class="btn" onclick="shareStream()">Share Stream</button>
            </div>
            
            <div class="control-panel">
                <h3>Match Info</h3>
                <p><strong>Stream Key:</strong> {{ stream_key }}</p>
                <p><strong>Status:</strong> <span id="stream-status">Ready</span></p>
                <p><strong>Quality:</strong> Auto (720p)</p>
            </div>
        </div>

        <div class="stream-info">
            <h4>ðŸ“º How to Stream:</h4>
            <ol>
                <li>Use your phone's screen recording or streaming app</li>
                <li>Start your game and begin playing</li>
                <li>Click "Start Streaming" above</li>
                <li>Other users can watch your gameplay live</li>
                <li>Submit your match result when done</li>
            </ol>
        </div>

        <div class="card">
            <h3>Stream Chat</h3>
            <div id="chat-messages" style="height: 200px; overflow-y: auto; background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                <p><strong>System:</strong> Stream chat is now active!</p>
            </div>
            <div style="display: flex; gap: 1rem;">
                <input type="text" id="chat-input" placeholder="Type a message..." style="flex: 1; padding: 0.8rem; border-radius: 5px; border: none;">
                <button class="btn" onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <script>
        let isStreaming = false;
        let viewerCount = 0;
        let viewerInterval = null;

        function startStream() {
            if (isStreaming) return;
            
            isStreaming = true;
            document.getElementById('stream-status').textContent = 'Streaming Live';
            document.querySelector('.live-indicator').style.display = 'inline-block';
            
            // Update button states
            document.querySelector('button[onclick="startStream()"]').disabled = true;
            document.querySelector('button[onclick="stopStream()"]').disabled = false;
            
            // Start viewer count simulation
            viewerInterval = setInterval(() => {
                if (isStreaming) {
                    viewerCount += Math.floor(Math.random() * 3);
                    document.getElementById('viewer-count').textContent = viewerCount;
                }
            }, 5000);
        }

        function stopStream() {
            if (!isStreaming) return;
            
            if (confirm('Are you sure you want to stop streaming? This will end the live stream for all viewers.')) {
                isStreaming = false;
                document.getElementById('stream-status').textContent = 'Stream Ended';
                document.querySelector('.live-indicator').style.display = 'none';
                
                // Clear viewer interval
                if (viewerInterval) {
                    clearInterval(viewerInterval);
                    viewerInterval = null;
                }
                
                // Update button states
                document.querySelector('button[onclick="startStream()"]').disabled = false;
                document.querySelector('button[onclick="stopStream()"]').disabled = true;
                
                // Reset viewer count
                viewerCount = 0;
                document.getElementById('viewer-count').textContent = '0';
                
                // Add system message to chat
                const messages = document.getElementById('chat-messages');
                const message = document.createElement('p');
                message.innerHTML = '<strong style="color: #dc3545;">System:</strong> Stream has ended.';
                messages.appendChild(message);
                messages.scrollTop = messages.scrollHeight;
            }
        }

        function shareStream() {
            const streamUrl = window.location.origin + '/watch_stream/{{ match_id }}';
            navigator.clipboard.writeText(streamUrl);
            alert('Stream link copied to clipboard!');
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const messages = document.getElementById('chat-messages');
            
            if (input.value.trim()) {
                const message = document.createElement('p');
                message.innerHTML = `<strong>You:</strong> ${input.value}`;
                messages.appendChild(message);
                messages.scrollTop = messages.scrollHeight;
                input.value = '';
            }
        }

        // Enter key to send message
        document.getElementById('chat-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Keyboard shortcut to stop stream (Ctrl+S)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 's' && isStreaming) {
                e.preventDefault();
                stopStream();
            }
        });
        
        // Initialize button states
        document.getElementById('stop-btn').disabled = true;
    </script>
</body>
</html>