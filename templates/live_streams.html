{% extends "base.html" %}

{% block content %}
<div class="card" style="background: linear-gradient(135deg, rgba(0,255,136,0.2), rgba(102,126,234,0.2)); border: 2px solid #00ff88;">
    <h1>ðŸ”´ Independent Live Streams</h1>
    <p>Start your own stream or watch others - No matches required, just pure gaming content!</p>
</div>

<!-- Start Independent Stream Button -->
<div class="card" style="background: linear-gradient(135deg, rgba(0,255,136,0.2), rgba(102,126,234,0.2)); border: 2px solid #00ff88; text-align: center;">
    <h3 style="color: #00ff88; margin-bottom: 1rem;">ðŸ”´ Ready to Go Live?</h3>
    <p style="margin-bottom: 1.5rem;">Start streaming your gameplay and earn money from viewers and ads!</p>
    <button onclick="startIndependentStream()" class="btn btn-success" style="font-size: 1.2rem; padding: 1rem 2rem;">
        ðŸ”´ Start Live Stream
    </button>
</div>

{% if streams %}
    <div class="card">
        <h2>ðŸ”´ Currently Live</h2>
    </div>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
        {% for stream in streams %}
        <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 1rem;">
                <div>
                    <h3 style="margin: 0;">{{ stream[4] }}</h3>
                    <p style="margin: 0.5rem 0; opacity: 0.8;">by {{ stream[9] }}</p>
                </div>
                <div style="background: #dc3545; color: white; padding: 0.3rem 0.6rem; border-radius: 15px; font-size: 0.8rem;">
                    ðŸ”´ LIVE
                </div>
            </div>
            
            <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <div style="aspect-ratio: 16/9; background: #000; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white;">
                    ðŸŽ® Live Gaming Stream
                </div>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <span style="color: #ffc107;">ðŸ‘¥ {{ stream[5] }} viewers</span>
                </div>
                <a href="/watch_real_stream/{{ stream[0] }}" class="btn btn-success">
                    ðŸ”´ Watch Live
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="card">
        <div style="text-align: center; padding: 2rem;">
            <h3>No One is Live Right Now</h3>
            <p>Be the first to start streaming and earn money!</p>
        </div>
    </div>
{% endif %}

<!-- Streaming Tips -->
<div class="card">
    <h2>ðŸ“º Streaming Tips</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
        <div style="background: rgba(40, 167, 69, 0.1); padding: 1rem; border-radius: 8px;">
            <h4 style="color: #28a745;">ðŸ’° Ad Revenue</h4>
            <p>Earn KSh 15/hour base + KSh 25/hour from ads + viewer bonuses! 60% of ad revenue goes to you!</p>
        </div>
        <div style="background: rgba(255, 193, 7, 0.1); padding: 1rem; border-radius: 8px;">
            <h4 style="color: #ffc107;">ðŸ‘¥ No Pressure</h4>
            <p>Stream any game, anytime! No matches required - just play and earn from your audience.</p>
        </div>
        <div style="background: rgba(23, 162, 184, 0.1); padding: 1rem; border-radius: 8px;">
            <h4 style="color: #17a2b8;">ðŸŽ¯ Freedom</h4>
            <p>Complete creative control - stream what you want, when you want, how you want!</p>
        </div>
    </div>
</div>

<!-- Independent Streaming Modal -->
<div id="streamModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #1a1a1a; padding: 2rem; border-radius: 15px; width: 90%; max-width: 500px;">
        <h3 style="color: #00ff88; margin-bottom: 1.5rem;">ðŸ”´ Start Live Stream</h3>
        
        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; color: #ffc107;">Stream Title:</label>
            <input type="text" id="streamTitle" placeholder="Enter your stream title..." 
                   style="width: 100%; padding: 0.8rem; border: 2px solid #333; background: #2a2a2a; color: white; border-radius: 8px;">
        </div>
        
        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; color: #ffc107;">Game Category:</label>
            <select id="gameCategory" style="width: 100%; padding: 0.8rem; border: 2px solid #333; background: #2a2a2a; color: white; border-radius: 8px;">
                <option value="pubg_mobile">PUBG Mobile</option>
                <option value="cod_mobile">Call of Duty Mobile</option>
                <option value="fifa_mobile">FIFA Mobile</option>
                <option value="fortnite">Fortnite</option>
                <option value="valorant">Valorant</option>
                <option value="other">Other Game</option>
            </select>
        </div>
        
        <div style="background: rgba(0,255,136,0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid #00ff88;">
            <h4 style="color: #00ff88; margin-bottom: 0.5rem;">ðŸ’° Earnings Info:</h4>
            <p style="margin: 0; font-size: 0.9rem;">â€¢ Base: KSh 15/hour â€¢ Viewer Bonus: KSh 5/viewer/hour<br>
            â€¢ Performance Bonus: Up to KSh 200 â€¢ Sponsor Bonus: KSh 50 (10+ viewers)</p>
        </div>
        
        <div style="display: flex; gap: 1rem; justify-content: center;">
            <button onclick="confirmStartStream()" class="btn btn-success">ðŸ”´ Go Live</button>
            <button onclick="closeStreamModal()" class="btn btn-secondary">Cancel</button>
        </div>
    </div>
</div>

<script>
function startIndependentStream() {
    document.getElementById('streamModal').style.display = 'block';
}

function closeStreamModal() {
    document.getElementById('streamModal').style.display = 'none';
}

function confirmStartStream() {
    const title = document.getElementById('streamTitle').value.trim();
    const category = document.getElementById('gameCategory').value;
    
    if (!title) {
        alert('Please enter a stream title!');
        return;
    }
    
    fetch('/start_independent_stream', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            title: title,
            category: category,
            type: 'independent'
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(`ðŸŽ‰ Stream started successfully!\n\nStream ID: ${data.stream_id}\nYou're now LIVE!\n\nStart earning money from viewers and ads!`);
            window.location.href = data.stream_url;
        } else {
            alert('Error: ' + data.error);
        }
    })
    .catch(error => {
        alert('Failed to start stream. Please try again.');
    });
}
</script>
{% endblock %}