{% extends "base.html" %}

{% block content %}
<div class="card">
    <h1>üí¨ Withdrawal Chat</h1>
    <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
        <strong>Withdrawal ID:</strong> #{{ withdrawal[0] }}<br>
        <strong>Amount:</strong> KSh {{ "%.0f"|format(withdrawal[3]|abs) }}<br>
        <strong>Status:</strong> 
        {% if withdrawal[2] == 'pending_withdrawal' %}
            <span style="color: #ffc107;">‚è≥ Processing</span>
        {% elif withdrawal[2] == 'withdrawal' %}
            <span style="color: #28a745;">‚úÖ Completed</span>
        {% else %}
            <span style="color: #dc3545;">‚ùå {{ withdrawal[2] }}</span>
        {% endif %}<br>
        <strong>Details:</strong> {{ withdrawal[4] }}<br>
        <strong>Date:</strong> {{ withdrawal[5] }}
    </div>
</div>

<div class="card">
    <h3>üí¨ Chat with Admin</h3>
    <div id="chatMessages" style="background: #f8f9fa; min-height: 300px; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; overflow-y: auto;">
        <div style="text-align: center; color: #666; padding: 2rem;">
            <div style="font-size: 2rem; margin-bottom: 1rem;">üí¨</div>
            <p>Chat with admin about your withdrawal</p>
            <p style="font-size: 0.9rem;">Admin will respond within 24 hours</p>
        </div>
    </div>
    
    <div style="display: flex; gap: 1rem;">
        <input type="text" id="messageInput" placeholder="Type your message..." style="flex: 1; padding: 0.8rem; border: 1px solid #ddd; border-radius: 6px;">
        <button onclick="sendMessage()" class="btn">Send</button>
    </div>
</div>

<div style="text-align: center; margin-top: 2rem;">
    <a href="{{ url_for('wallet') }}" class="btn btn-secondary">‚Üê Back to Wallet</a>
</div>

<script>
function sendMessage() {
    const input = document.getElementById('messageInput');
    const message = input.value.trim();
    
    if (!message) return;
    
    // Add message to chat
    const chatDiv = document.getElementById('chatMessages');
    chatDiv.innerHTML += `
        <div style="background: #007bff; color: white; padding: 0.8rem; border-radius: 8px; margin-bottom: 0.5rem; max-width: 70%; margin-left: auto;">
            <strong>You:</strong> ${message}
            <div style="font-size: 0.8rem; opacity: 0.8; margin-top: 0.3rem;">${new Date().toLocaleString()}</div>
        </div>
    `;
    
    // Auto-scroll to bottom
    chatDiv.scrollTop = chatDiv.scrollHeight;
    
    // Clear input
    input.value = '';
    
    // Simulate admin response (in real app, this would be sent to admin)
    setTimeout(() => {
        chatDiv.innerHTML += `
            <div style="background: #28a745; color: white; padding: 0.8rem; border-radius: 8px; margin-bottom: 0.5rem; max-width: 70%;">
                <strong>Admin:</strong> Thank you for your message. We're processing your withdrawal and will update you soon.
                <div style="font-size: 0.8rem; opacity: 0.8; margin-top: 0.3rem;">${new Date().toLocaleString()}</div>
            </div>
        `;
        chatDiv.scrollTop = chatDiv.scrollHeight;
    }, 2000);
}

// Send message on Enter key
document.getElementById('messageInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        sendMessage();
    }
});
</script>
{% endblock %}