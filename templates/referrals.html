{% extends "base.html" %}

{% block content %}
<div class="card">
    <h1>Referral System</h1>
    <p>Invite friends and earn money from their activity!</p>
</div>

<!-- Referral Stats -->
<div class="card">
    <h2>Your Referral Stats</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
        <div style="background: rgba(40, 167, 69, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
            <div style="font-size: 2rem; font-weight: bold; color: #28a745;">{{ referred_users|length }}</div>
            <div>Friends Referred</div>
        </div>
        <div style="background: rgba(255, 193, 7, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
            <div style="font-size: 2rem; font-weight: bold; color: #ffc107;">KSh {{ "%.0f"|format(referral_earnings) }}</div>
            <div>Total Earnings</div>
        </div>
        <div style="background: rgba(23, 162, 184, 0.1); padding: 1rem; border-radius: 8px; text-align: center;">
            <div style="font-size: 2rem; font-weight: bold; color: #17a2b8;">KSh {{ "%.0f"|format(referred_users|length * 30) }}</div>
            <div>Signup Bonuses</div>
        </div>
    </div>
</div>

<!-- Referral Code -->
<div class="card">
    <h2>Your Referral Link</h2>
    <div style="background: rgba(0,255,136,0.1); padding: 2rem; border-radius: 8px; text-align: center;">
        <div style="font-size: 3rem; font-weight: bold; color: #00ff88; margin-bottom: 1rem;">
            {{ referral_code or 'Loading...' }}
        </div>
        <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0; font-family: monospace; word-break: break-all;">
            {% if referral_code and referral_code != 'None' %}
                {{ request.url_root }}register?ref={{ referral_code }}
            {% else %}
                Loading referral link...
            {% endif %}
        </div>
        <button onclick="copyReferralLink()" class="btn btn-success" style="margin-right: 1rem;">Copy Link</button>
        <button onclick="shareReferralLink()" class="btn btn-primary">Share Link</button>
    </div>
</div>

<!-- How It Works -->
<div class="card">
    <h2>How Referrals Work</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
        <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
            <h3 style="color: #00ff88;">1. Share Your Link</h3>
            <p>Send your referral link to friends</p>
        </div>
        <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
            <h3 style="color: #ffc107;">2. Instant Bonus</h3>
            <p>Get KSh 30 immediately when they sign up</p>
        </div>
        <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
            <h3 style="color: #17a2b8;">3. Lifetime Earnings</h3>
            <p>Earn 4% of all their losses forever!</p>
        </div>
    </div>
</div>

<!-- Referred Friends -->
<div class="card">
    <h2>Your Referred Friends</h2>
    {% if referred_users %}
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: rgba(255,255,255,0.1);">
                        <th style="padding: 1rem; text-align: left;">Username</th>
                        <th style="padding: 1rem; text-align: left;">Joined Date</th>
                        <th style="padding: 1rem; text-align: left;">Status</th>
                        <th style="padding: 1rem; text-align: left;">Your Earnings</th>
                    </tr>
                </thead>
                <tbody>
                    {% for friend in referred_users %}
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <td style="padding: 1rem;">{{ friend[0] }}</td>
                        <td style="padding: 1rem;">{{ friend[1] }}</td>
                        <td style="padding: 1rem;"><span style="color: #28a745;">Active</span></td>
                        <td style="padding: 1rem; color: #00ff88;">KSh 30+</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div style="text-align: center; padding: 2rem;">
            <p>No friends referred yet. Start sharing your code!</p>
            <button onclick="shareReferralLink()" class="btn btn-primary">Share Now</button>
        </div>
    {% endif %}
</div>

<!-- Referral Tips -->
<div class="card">
    <h2>Maximize Your Earnings</h2>
    <div style="background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px;">
        <div style="background: rgba(40,167,69,0.2); padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #28a745;">
            <h4 style="color: #28a745; margin: 0 0 10px 0;">How Referrals Work:</h4>
            <div style="font-size: 14px; line-height: 1.6;">
                <strong>1. Instant Bonus:</strong> Get KSh 30 when friend signs up<br>
                <strong>2. Lifetime Earnings:</strong> Earn 4% of all their match losses<br>
                <strong>3. No Limits:</strong> Refer unlimited friends, earn forever
            </div>
        </div>
        <ul style="margin: 0; padding-left: 1.5rem;">
            <li><strong>Share on WhatsApp:</strong> Send to gaming groups</li>
            <li><strong>Social Media:</strong> Post on Facebook, Instagram</li>
            <li><strong>Gaming Communities:</strong> Share in PUBG/FIFA groups</li>
            <li><strong>Friends & Family:</strong> Personal invitations work best</li>
            <li><strong>Offer Help:</strong> Teach them how to play and win</li>
        </ul>
    </div>
</div>

<script>
function copyReferralLink() {
    const code = '{{ referral_code }}';
    if (code && code !== 'None') {
        const link = '{{ request.url_root }}register?ref=' + code;
        navigator.clipboard.writeText(link).then(() => {
            alert('Referral link copied!');
        });
    } else {
        alert('Referral code not ready yet. Please refresh the page.');
    }
}

function shareReferralLink() {
    const code = '{{ referral_code }}';
    if (code && code !== 'None') {
        const link = '{{ request.url_root }}register?ref=' + code;
        const message = `Join SkillState and win money playing games!

Register using my link: ${link}

Bet on PUBG, FIFA, COD Mobile
Join tournaments with big prizes
Instant M-Pesa withdrawals

Start earning money from gaming!`;

        if (navigator.share) {
            navigator.share({
                title: 'Join SkillState - Win Money Gaming!',
                text: message
            });
        } else {
            navigator.clipboard.writeText(message).then(() => {
                alert('Referral message copied! Share it anywhere.');
            });
        }
    } else {
        alert('Referral code not ready yet. Please refresh the page.');
    }
}
</script>
{% endblock %}