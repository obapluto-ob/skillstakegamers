{% extends "base.html" %}

{% block content %}
<div class="card">
    <h1>🎯 Referral Program</h1>
    <p>Earn KSh 50 for every friend you refer who joins SkillStake Gaming!</p>
</div>

<div class="card">
    <h2>📋 Your Referral Details</h2>
    
    {% if referral_code %}
    <div style="background: #d4edda; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
        <h4 style="color: #155724;">🔗 Your Referral Code:</h4>
        <div style="background: white; padding: 0.8rem; border-radius: 6px; font-family: monospace; font-size: 1.2rem; font-weight: bold; color: #28a745; border: 2px solid #28a745;">
            {{ referral_code }}
        </div>
    </div>
    
    <div style="background: #e7f3ff; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
        <h4 style="color: #0c5460;">🌐 Your Referral Link:</h4>
        <div style="background: white; padding: 0.8rem; border-radius: 6px; font-family: monospace; word-break: break-all; border: 2px solid #17a2b8;">
            {{ referral_link }}
        </div>
        <button onclick="copyReferralLink()" class="btn btn-primary" style="margin-top: 0.5rem;">📋 Copy Link</button>
    </div>
    {% endif %}
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin: 1rem 0;">
        <div style="background: #28a745; color: white; padding: 1rem; border-radius: 8px; text-align: center;">
            <div style="font-size: 1.5rem;">{{ earnings_data.referred_count if earnings_data else 0 }}</div>
            <div>Friends Referred</div>
        </div>
        <div style="background: #17a2b8; color: white; padding: 1rem; border-radius: 8px; text-align: center;">
            <div style="font-size: 1.5rem;">KSh {{ "%.0f"|format(earnings_data.signup_bonuses if earnings_data else 0) }}</div>
            <div>Signup Bonuses</div>
        </div>
        <div style="background: #dc3545; color: white; padding: 1rem; border-radius: 8px; text-align: center;">
            <div style="font-size: 1.5rem;">KSh {{ "%.0f"|format(earnings_data.ongoing_commissions if earnings_data else 0) }}</div>
            <div>4% Commissions</div>
        </div>
        <div style="background: #ffc107; color: black; padding: 1rem; border-radius: 8px; text-align: center;">
            <div style="font-size: 1.5rem;">KSh {{ "%.0f"|format(earnings_data.total_earnings if earnings_data else 0) }}</div>
            <div>Total Earned</div>
        </div>
    </div>
</div>

<div class="card">
    <h2>💰 SkillStake Referral Commission System</h2>
    <div style="background: #d4edda; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
        <h4 style="color: #155724; margin-top: 0;">🎯 Dual Earning System:</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 1rem 0;">
            <div>
                <h5 style="color: #155724;">💵 Signup Bonus</h5>
                <p style="color: #155724; margin: 0;">Earn <strong>KSh 50</strong> instantly when someone registers using your referral link</p>
            </div>
            <div>
                <h5 style="color: #155724;">📈 Ongoing Commission</h5>
                <p style="color: #155724; margin: 0;">Earn <strong>4% commission</strong> every time your referred friends lose matches - lifetime earnings!</p>
            </div>
        </div>
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin: 1rem 0;">
        <div style="text-align: center;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">1️⃣</div>
            <h3>Share Your Link</h3>
            <p>Send your referral link to friends via WhatsApp, SMS, or social media</p>
        </div>
        <div style="text-align: center;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">2️⃣</div>
            <h3>Friend Registers & Plays</h3>
            <p>They sign up using your link and start playing matches</p>
        </div>
        <div style="text-align: center;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">3️⃣</div>
            <h3>Earn Forever</h3>
            <p>KSh 50 signup bonus + 4% of every match they lose = lifetime income!</p>
        </div>
    </div>
</div>

{% if referred_users %}
<div class="card">
    <h2>👥 Your Referrals</h2>
    <div style="display: grid; gap: 1rem;">
        {% for user in referred_users %}
        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
            <div>
                <strong>{{ user[0] }}</strong>
                <div style="color: #666; font-size: 0.9rem;">Joined: {{ user[1].split(' ')[0] if user[1] else 'N/A' }}</div>
            </div>
            <div style="background: #28a745; color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem;">
                +KSh 50
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% else %}
<div class="card">
    <div style="text-align: center; padding: 2rem;">
        <h3>No referrals yet</h3>
        <p>Start sharing your referral link to earn bonuses!</p>
    </div>
</div>
{% endif %}

<script>
function copyReferralLink() {
    const link = "{{ referral_link }}";
    navigator.clipboard.writeText(link).then(function() {
        alert('✅ Referral link copied to clipboard!');
    }, function(err) {
        // Fallback for older browsers
        const textArea = document.createElement("textarea");
        textArea.value = link;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert('✅ Referral link copied to clipboard!');
    });
}
</script>
{% endblock %}