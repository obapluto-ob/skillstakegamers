{% extends "base.html" %}

{% block content %}
<div class="card">
    <h1>âš”ï¸ Battle Status</h1>
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h3>{{ battle[1]|replace('_', ' ')|title }}</h3>
            <p>Battle #{{ battle[0] }} â€¢ Gameweek {{ battle[10] }}</p>
        </div>
        <div>
            {% if battle[9] == 'open' %}
                <span class="status-badge" style="background: #fff3cd; color: #856404;">ğŸŸ¡ Open</span>
            {% elif battle[9] == 'active' %}
                <span class="status-badge" style="background: #d4edda; color: #155724;">ğŸŸ¢ Active</span>
            {% elif battle[9] == 'completed' %}
                <span class="status-badge" style="background: #cce5ff; color: #004085;">âœ… Completed</span>
            {% elif battle[9] == 'draw' %}
                <span class="status-badge" style="background: #f8d7da; color: #721c24;">ğŸ¤ Draw</span>
            {% endif %}
        </div>
    </div>
</div>

<div class="card">
    <h3>Battle Details</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem;">
        <div>
            <h4>ğŸ’° Stakes & Pot</h4>
            <p><strong>Stake:</strong> KSh {{ battle[6] }} each</p>
            <p><strong>Total Pot:</strong> KSh {{ battle[7] }}</p>
            <p><strong>Commission:</strong> 8%</p>
        </div>
        
        <div>
            <h4>ğŸ“… Timeline</h4>
            <p><strong>Created:</strong> {{ battle[13][:16] }}</p>
            {% if battle[14] %}
                <p><strong>Completed:</strong> {{ battle[14][:16] }}</p>
            {% endif %}
            <p><strong>Gameweek:</strong> {{ battle[10] }}</p>
        </div>
        
        <div>
            <h4>ğŸ¯ Battle Type</h4>
            <p>{{ battle[1]|replace('_', ' ')|title }}</p>
            {% if battle[1] == 'gameweek_points' %}
                <small>Total points scored in gameweek {{ battle[10] }}</small>
            {% elif battle[1] == 'captain_battle' %}
                <small>Captain points only</small>
            {% elif battle[1] == 'transfer_battle' %}
                <small>Best transfer performance</small>
            {% endif %}
        </div>
    </div>
</div>

<div class="card">
    <h3>ğŸ‘¥ Participants</h3>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
        <!-- Creator -->
        <div style="background: rgba(40,167,69,0.1); padding: 1.5rem; border-radius: 8px; border-left: 4px solid #28a745;">
            <h4>{{ battle[16] or 'Creator' }}</h4>
            <p><strong>FPL Team ID:</strong> {{ battle[3] }}</p>
            {% if battle[9] in ['completed', 'draw'] %}
                <p><strong>Points:</strong> {{ battle[11] or 0 }}</p>
            {% endif %}
            {% if battle[9] == 'completed' and battle[8] == battle[2] %}
                <div style="color: #28a745; font-weight: bold;">ğŸ† Winner!</div>
            {% endif %}
        </div>
        
        <!-- Opponent -->
        <div style="background: rgba(220,53,69,0.1); padding: 1.5rem; border-radius: 8px; border-left: 4px solid #dc3545;">
            {% if battle[17] %}
                <h4>{{ battle[17] }}</h4>
                <p><strong>FPL Team ID:</strong> {{ battle[5] }}</p>
                {% if battle[9] in ['completed', 'draw'] %}
                    <p><strong>Points:</strong> {{ battle[12] or 0 }}</p>
                {% endif %}
                {% if battle[9] == 'completed' and battle[8] == battle[4] %}
                    <div style="color: #28a745; font-weight: bold;">ğŸ† Winner!</div>
                {% endif %}
            {% else %}
                <h4>Waiting for Opponent</h4>
                <p style="color: #666; font-style: italic;">Battle is open for others to join</p>
            {% endif %}
        </div>
    </div>
</div>

{% if battle[9] == 'completed' %}
<div class="card">
    <h3>ğŸ† Final Result</h3>
    <div style="text-align: center; padding: 2rem;">
        {% if battle[8] == battle[2] %}
            <div style="font-size: 2rem; color: #28a745; margin-bottom: 1rem;">ğŸ‰</div>
            <h2 style="color: #28a745;">{{ battle[16] }} Wins!</h2>
            <p>Final Score: {{ battle[11] }} - {{ battle[12] }}</p>
        {% elif battle[8] == battle[4] %}
            <div style="font-size: 2rem; color: #28a745; margin-bottom: 1rem;">ğŸ‰</div>
            <h2 style="color: #28a745;">{{ battle[17] }} Wins!</h2>
            <p>Final Score: {{ battle[11] }} - {{ battle[12] }}</p>
        {% endif %}
        <p><strong>Prize:</strong> KSh {{ battle[7] }}</p>
    </div>
</div>
{% elif battle[9] == 'draw' %}
<div class="card">
    <h3>ğŸ¤ Draw Result</h3>
    <div style="text-align: center; padding: 2rem;">
        <div style="font-size: 2rem; margin-bottom: 1rem;">ğŸ¤</div>
        <h2 style="color: #6c757d;">It's a Draw!</h2>
        <p>Final Score: {{ battle[11] }} - {{ battle[12] }}</p>
        <p><strong>Stakes Refunded:</strong> KSh {{ battle[6] }} each</p>
    </div>
</div>
{% elif battle[9] == 'active' %}
<div class="card">
    <h3>â³ Battle in Progress</h3>
    <div style="text-align: center; padding: 2rem;">
        <div style="font-size: 2rem; margin-bottom: 1rem;">âš½</div>
        <h3>Gameweek {{ battle[10] }} is Live!</h3>
        <p>Battle will be resolved automatically when the gameweek ends.</p>
        <p>Check back later for results.</p>
    </div>
</div>
{% endif %}

<div class="card">
    <div style="display: flex; gap: 1rem;">
        <a href="/my_fpl_battles" class="btn btn-secondary">â† Back to My Battles</a>
        <a href="/fpl_battles" class="btn btn-primary">View All Battles</a>
        {% if battle[9] == 'active' %}
            <a href="https://fantasy.premierleague.com" target="_blank" class="btn btn-success">Check FPL Live Scores</a>
        {% endif %}
    </div>
</div>

{% endblock %}