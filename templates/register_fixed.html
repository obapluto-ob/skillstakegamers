{% extends "base.html" %}

{% block content %}
<div class="hero-section">
    <div class="hero-content">
        <h1 class="hero-title">Join SkillStake</h1>
        <p class="hero-subtitle">Turn Your Gaming Skills Into Real Money</p>
        <div class="hero-stats">
            <div class="stat-highlight">Email Verification</div>
            <div class="stat-highlight">Secure Registration</div>
            <div class="stat-highlight">Real Money Gaming</div>
        </div>
    </div>
</div>

<div class="auth-container">
    <div class="auth-card">
        <h2>Create Your Account</h2>
        <div id="registrationForm">
            <div id="step1" style="display: block;">
                <form id="userDetailsForm">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="username" class="form-control" placeholder="Choose a unique username" required minlength="3" maxlength="20">
                        <small style="color: #666;">3-20 characters, letters and numbers only</small>
                    </div>

                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" id="email" class="form-control" placeholder="your@email.com" required>
                        <small style="color: #666;">Used for login and notifications</small>
                    </div>

                    <div class="form-group">
                        <label>Phone Number (Optional)</label>
                        <input type="tel" id="phone" class="form-control" placeholder="0712345678 (for M-Pesa payments)">
                        <small style="color: #666;">Required for withdrawals</small>
                    </div>

                    <div class="form-group">
                        <label>Password</label>
                        <div class="password-input-container" style="position: relative;">
                            <input type="password" id="password" class="form-control" placeholder="Create a strong password" required minlength="6">
                            <button type="button" class="password-toggle" onclick="togglePassword('password')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: #666;">
                                Show
                            </button>
                        </div>
                        <small style="color: #666;">Minimum 6 characters</small>
                    </div>

                    <button type="button" onclick="sendVerificationCode()" class="btn auth-btn">Send Verification Code</button>
                </form>
            </div>
            
            <div id="step2" style="display: none;">
                <h3>Enter Verification Code</h3>
                <p>We sent a 6-digit code to your email. Please enter it below:</p>
                <form id="verificationForm">
                    <div class="form-group">
                        <label>Verification Code</label>
                        <input type="text" id="verificationCode" class="form-control" placeholder="Enter 6-digit code" maxlength="6" required>
                    </div>
                    <button type="button" onclick="completeRegistration()" class="btn auth-btn">Complete Registration</button>
                    <button type="button" onclick="sendVerificationCode()" class="btn btn-secondary">Resend Code</button>
                </form>
            </div>
        </div>

        
        <p class="auth-link">
            Already have an account? <a href="{{ url_for('login') }}">Login here</a> | 
            <a href="{{ url_for('forgot_password') }}">Forgot Password?</a>
        </p>
    </div>
    
    <div class="games-showcase">
        <h3>Available Games</h3>
        <div class="games-preview">
            <div class="game-preview">
                <img src="https://images.unsplash.com/photo-1574629810360-7efbbe195018?w=50&h=50&fit=crop" style="width: 40px; height: 40px; border-radius: 8px; margin-right: 1rem;">
                <span>FIFA Mobile</span>
            </div>
            <div class="game-preview">
                <img src="https://images.unsplash.com/photo-1431324155629-1a6deb1dec8d?w=50&h=50&fit=crop" style="width: 40px; height: 40px; border-radius: 8px; margin-right: 1rem;">
                <span>eFootball</span>
            </div>
            <div class="game-preview">
                <img src="https://images.unsplash.com/photo-1542751371-adc38448a05e?w=50&h=50&fit=crop" style="width: 40px; height: 40px; border-radius: 8px; margin-right: 1rem;">
                <span>FPL Battles</span>
            </div>
        </div>
        
        <div class="how-it-works">
            <h4>How It Works</h4>
            <div class="step-item">1. Deposit via Crypto (USDT)</div>
            <div class="step-item">2. Create/Join matches</div>
            <div class="step-item">3. Upload match results</div>
            <div class="step-item">4. Winner takes 92% of pot</div>
            <div class="step-item">5. Withdraw anytime</div>
        </div>
    </div>
</div>

<script>
function togglePassword(fieldId) {
    const field = document.getElementById(fieldId);
    const button = field.nextElementSibling;
    
    if (field.type === 'password') {
        field.type = 'text';
        button.textContent = 'Hide';
    } else {
        field.type = 'password';
        button.textContent = 'Show';
    }
}

function sendVerificationCode() {
    const username = document.getElementById('username').value;
    const email = document.getElementById('email').value;
    const phone = document.getElementById('phone').value;
    const password = document.getElementById('password').value;
    
    if (!username || !email || !password) {
        alert('Please fill in all required fields');
        return;
    }
    
    fetch('/send_verification', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({email: email})
    })
    .then(r => r.json())
    .then(d => {
        if (d.success) {
            document.getElementById('step1').style.display = 'none';
            document.getElementById('step2').style.display = 'block';
            alert('Verification code sent to your email!');
        } else {
            alert(d.message);
        }
    })
    .catch(e => alert('Error sending code'));
}

function completeRegistration() {
    const username = document.getElementById('username').value;
    const email = document.getElementById('email').value;
    const phone = document.getElementById('phone').value;
    const password = document.getElementById('password').value;
    const code = document.getElementById('verificationCode').value;
    
    fetch('/register_with_verification', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            username: username,
            email: email,
            phone: phone,
            password: password,
            code: code
        })
    })
    .then(r => r.json())
    .then(d => {
        if (d.success) {
            alert('Registration successful! You can now login.');
            window.location.href = '/login';
        } else {
            alert(d.message);
        }
    })
    .catch(e => alert('Registration failed'));
}
</script>

<style>
.password-input-container {
    position: relative;
}

.password-toggle {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    cursor: pointer;
    color: #666;
    font-size: 1.2rem;
}

.password-toggle:hover {
    color: #333;
}

.form-control {
    padding-right: 40px;
}

.auth-btn:disabled {
    background: #6c757d !important;
    cursor: not-allowed;
}

.step-item {
    padding: 0.5rem 0;
    border-left: 3px solid #00ff88;
    padding-left: 1rem;
    margin: 0.5rem 0;
}
</style>
{% endblock %}